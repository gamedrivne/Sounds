<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sound Gallery</title>
  <style>
    :root{
      --bg:#0f1720;
      --card:#12202a;
      --accent:#00bcd4;
      --muted:#9aa8b0;
      --white:#ffffff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--white);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    header{
      padding:14px 12px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      background:linear-gradient(90deg, rgba(0,0,0,0.2), rgba(0,0,0,0.1));
      border-bottom:1px solid rgba(255,255,255,0.03);
    }
    header h1{
      margin:0;
      font-size:16px;
      letter-spacing:0.2px;
    }

    .controls{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .search{
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      padding:8px 10px;
      border-radius:10px;
      color:var(--white);
      width:200px;
    }
    .btn{
      background:var(--accent);
      color:#001;
      padding:8px 10px;
      border-radius:10px;
      border:none;
      font-weight:600;
    }

    main{
      padding:10px;
      flex:1 1 auto;
      overflow:auto;
    }

    #gallery{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:10px;
      align-items:start;
    }

    .card{
      background:var(--card);
      padding:10px;
      border-radius:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:110px;
      box-shadow:0 6px 18px rgba(0,0,0,0.4);
    }
    .title{
      font-size:14px;
      font-weight:700;
      color:var(--white);
      margin:0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .subtitle{
      font-size:12px;
      color:var(--muted);
      margin:0;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .controls-row{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:flex-start;
      flex-wrap:wrap;
    }

    .small-btn{
      padding:6px 8px;
      border-radius:8px;
      border:none;
      background:rgba(255,255,255,0.06);
      color:var(--white);
      font-weight:600;
    }

    audio {
      width:100%;
      outline:none;
      border-radius:8px;
      background:transparent;
    }

    /* Global player at bottom */
    .player {
      position:sticky;
      bottom:0;
      left:0;
      right:0;
      background:linear-gradient(180deg, rgba(0,0,0,0.3), rgba(0,0,0,0.5));
      border-top:1px solid rgba(255,255,255,0.03);
      padding:10px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .player .meta { display:flex; gap:10px; align-items:center; }
    .player .meta .name { font-weight:700; }
    .player .controls { display:flex; gap:8px; align-items:center; }

    /* Responsive */
    @media (min-width:700px){
      #gallery{ grid-template-columns: repeat(3,1fr); }
      .search{ width:300px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>üéß Sound Gallery</h1>
    <div class="controls">
      <input id="search" class="search" placeholder="Search by title..." />
      <button id="stopAll" class="btn" title="Stop all">Stop All</button>
    </div>
  </header>

  <main>
    <div id="gallery" aria-live="polite"></div>
  </main>

  <!-- Global player -->
  <div id="player" class="player" style="display:none">
    <div class="meta">
      <div class="name" id="playerTitle">‚Äî</div>
      <div class="time" id="playerTime" style="color:var(--muted);font-size:13px">0:00</div>
    </div>
    <div class="controls">
      <button id="prevBtn" class="small-btn">‚èÆ</button>
      <button id="playBtn" class="small-btn">‚ñ∂</button>
      <button id="pauseBtn" class="small-btn">‚è∏</button>
      <button id="stopBtn" class="small-btn">‚èπ</button>
      <a id="downloadLink" class="small-btn" download>‚¨áÔ∏è</a>
    </div>
  </div>

  <script>
    // URL vers ton sounds.json (raw Github)
    const API_URL = "https://raw.githubusercontent.com/gamedrivne/Sounds/main/sounds.json";

    const gallery = document.getElementById('gallery');
    const search = document.getElementById('search');
    const stopAllBtn = document.getElementById('stopAll');

    // global player elements
    const player = document.getElementById('player');
    const playerTitle = document.getElementById('playerTitle');
    const playerTime = document.getElementById('playerTime');
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const stopBtn = document.getElementById('stopBtn');
    const prevBtn = document.getElementById('prevBtn');
    const downloadLink = document.getElementById('downloadLink');

    let sounds = [];            // data from JSON
    let audioElements = [];     // <audio> nodes for each item (optional)
    let globalAudio = new Audio(); // global player
    let currentIndex = -1;

    // fetch sounds.json
    fetch(API_URL)
      .then(res => res.json())
      .then(data => {
        sounds = data.sounds || [];
        renderGallery(sounds);
      })
      .catch(err => {
        console.error("Failed to load sounds.json:", err);
        gallery.innerHTML = "<p style='color:#f88'>Failed to load sounds.</p>";
      });

    function renderGallery(list){
      gallery.innerHTML = "";
      audioElements = [];

      list.forEach((s, idx) => {
        const card = document.createElement('div');
        card.className = 'card';

        const title = document.createElement('h3');
        title.className = 'title';
        title.textContent = s.title || `Sound ${idx+1}`;

        const subtitle = document.createElement('div');
        subtitle.className = 'subtitle';
        subtitle.textContent = s.file || '';

        // create small audio element (hidden controls optional)
        const audio = document.createElement('audio');
        audio.src = s.file;
        audio.preload = 'none'; // reduce initial bandwidth
        audioElements.push(audio);

        // control buttons for this sound
        const controlsRow = document.createElement('div');
        controlsRow.className = 'controls-row';

        const playBtnLocal = document.createElement('button');
        playBtnLocal.className = 'small-btn';
        playBtnLocal.textContent = '‚ñ∂ Play';
        playBtnLocal.onclick = () => {
          pauseAll();
          audio.play();
          showGlobalPlayer(idx);
        };

        const pauseBtnLocal = document.createElement('button');
        pauseBtnLocal.className = 'small-btn';
        pauseBtnLocal.textContent = '‚è∏ Pause';
        pauseBtnLocal.onclick = () => audio.pause();

        const stopBtnLocal = document.createElement('button');
        stopBtnLocal.className = 'small-btn';
        stopBtnLocal.textContent = '‚èπ Stop';
        stopBtnLocal.onclick = () => { audio.pause(); audio.currentTime = 0; };

        const useGlobalBtn = document.createElement('button');
        useGlobalBtn.className = 'small-btn';
        useGlobalBtn.textContent = '‚ñ∂ Use player';
        useGlobalBtn.onclick = () => { setGlobal(idx); playGlobal(); };

        const download = document.createElement('a');
        download.className = 'small-btn';
        download.href = s.file;
        download.download = s.title || `sound-${idx+1}.mp3`;
        download.textContent = '‚¨áÔ∏è Download';

        controlsRow.append(playBtnLocal, pauseBtnLocal, stopBtnLocal, useGlobalBtn, download);

        card.append(title, subtitle, controlsRow /*, audio */);
        gallery.appendChild(card);

        // update global when local audio ends (optional)
        audio.onended = () => {
          // if this audio was the one in global player, reset UI
          if (currentIndex === idx) {
            updatePlayerTime(0);
          }
        };
      });
    }

    // Pause all local audios (not global)
    function pauseAll(){
      audioElements.forEach(a => {
        try{ a.pause(); } catch(e){}
      });
    }

    // Stop all (local + global)
    stopAllBtn.onclick = () => {
      pauseAll();
      globalAudio.pause();
      globalAudio.currentTime = 0;
      hidePlayer();
    };

    // ------ GLOBAL PLAYER functions ------
    function setGlobal(index){
      if (!sounds[index]) return;
      currentIndex = index;
      globalAudio.src = sounds[index].file;
      playerTitle.textContent = sounds[index].title || `Track ${index+1}`;
      downloadLink.href = sounds[index].file;
      downloadLink.download = (sounds[index].title || `sound-${index+1}`) + '.mp3';
      player.style.display = 'flex';
      updatePlayerTime(0);
      // bind timeupdate
      globalAudio.ontimeupdate = () => {
        const t = Math.floor(globalAudio.currentTime);
        playerTime.textContent = formatTime(t);
      };
      globalAudio.onended = () => {
        playerTime.textContent = formatTime(Math.floor(globalAudio.duration || 0));
      };
    }

    function showGlobalPlayer(index){
      setGlobal(index);
      playGlobal();
    }

    function playGlobal(){ if (globalAudio.src) globalAudio.play(); }
    function pauseGlobal(){ globalAudio.pause(); }
    function stopGlobal(){ globalAudio.pause(); globalAudio.currentTime = 0; }
    function hidePlayer(){ player.style.display = 'none'; currentIndex = -1; }

    playBtn.onclick = () => playGlobal();
    pauseBtn.onclick = () => pauseGlobal();
    stopBtn.onclick = () => { stopGlobal(); hidePlayer(); };
    prevBtn.onclick = () => {
      if (currentIndex > 0) { setGlobal(currentIndex-1); playGlobal(); }
    };

    function playLocalByIndex(i){
      if (audioElements[i]) {
        pauseAll();
        audioElements[i].play();
      }
    }

    function updatePlayerTime(sec){
      playerTime.textContent = formatTime(sec);
    }

    function formatTime(s){
      if (!s && s !== 0) return '0:00';
      const m = Math.floor(s / 60);
      const sec = s % 60;
      return `${m}:${sec.toString().padStart(2,'0')}`;
    }

    // search filter
    search.addEventListener('input', (e) => {
      const q = e.target.value.trim().toLowerCase();
      if (!q) {
        renderGallery(sounds);
        return;
      }
      const filtered = sounds.filter(s => (s.title || '').toLowerCase().includes(q));
      renderGallery(filtered);
    });

    // small UX: click outside to hide player (optional)
    document.addEventListener('click', (ev) => {
      // do nothing here for now
    });

    // init: hide player until used
    hidePlayer();

  </script>
</body>
</html>
